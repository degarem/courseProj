!function(t,e){"function"==typeof define&&define.amd?define(["jQuery"],e):"object"==typeof exports?e(require("jQuery")):e(t.jQuery)}(this,function(t){var e,s,n,i,r,a,h,o,l,c,d=(e={},s=new RegExp("{{([^}]+)}}","g"),e.parse=function(t){function e(t){for(var e=t.length,s=0;s<e;s++)n.inpts[h]=t.charAt(s),h++;a++,o+=t.length+4-1}for(var n={inpts:{},chars:{}},i=function(t){for(var e,n=[];e=s.exec(t);)n.push(e);return n}(t),r=t.length,a=0,h=0,o=0;o<r;o++)a<i.length&&o===i[a].index?e(i[a][1]):n.chars[o-4*a]=t.charAt(o);return n.mLength=o-4*a,n},e),u=((n={}).extend=function(t){for(var e=1;e<arguments.length;e++)for(var s in arguments[e])t[s]=arguments[e][s];return t},n.addChars=function(t,e,s){return t.substr(0,s)+e+t.substr(s,t.length)},n.removeChars=function(t,e,s){return t.substr(0,e)+t.substr(s,t.length)},n.isBetween=function(t,e){return e.sort(function(t,e){return t-e}),t>e[0]&&t<e[1]},n.addListener=function(t,e,s){return void 0!==t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent("on"+e,s)},n.preventDefault=function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1},n.getClip=function(t){return t.clipboardData?t.clipboardData.getData("Text"):window.clipboardData?window.clipboardData.getData("Text"):void 0},n.getMatchingKey=function(t,e,s){for(var n in s){var i=s[n];if(t===i.which&&e===i.keyCode)return n}},n.isDelKeyDown=function(t,e){return n.getMatchingKey(t,e,{backspace:{which:8,keyCode:8},delete:{which:46,keyCode:46}})},n.isDelKeyPress=function(t,e){return n.getMatchingKey(t,e,{backspace:{which:8,keyCode:8,shiftKey:!1},delete:{which:0,keyCode:46}})},n.isSpecialKeyPress=function(t,e){return n.getMatchingKey(t,e,{tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40}})},n.isModifier=function(t){return t.ctrlKey||t.altKey||t.metaKey},n.forEach=function(t,e,s){if(t.hasOwnProperty("length"))for(var n=0,i=t.length;n<i&&!1!==e.call(s,t[n],n,t);n++);else for(var r in t)if(t.hasOwnProperty(r)&&!1===e.call(s,t[r],r,t))break},n),p=(i=d,function(t){var e=[],s=[];return r.forEach(t,function(t){r.forEach(t,function(t,n){var r=i.parse(t),a="*"===n?/.*/:new RegExp(n);return e.push(a),s.push(r),!1})}),{getPattern:function(t){var n;return r.forEach(e,function(e,s){if(e.test(t))return n=s,!1}),void 0===n?null:s[n]},patterns:s,matchers:e}}),f=(a=p,o=r=u,l={persistent:!(h={get:function(t){if("number"==typeof t.selectionStart)return{begin:t.selectionStart,end:t.selectionEnd};var e=document.selection.createRange();if(e&&e.parentElement()===t){var s=t.createTextRange(),n=t.createTextRange(),i=t.value.length;return s.moveToBookmark(e.getBookmark()),n.collapse(!1),-1<s.compareEndPoints("StartToEnd",n)?{begin:i,end:i}:{begin:-s.moveStart("character",-i),end:-s.moveEnd("character",-i)}}return{begin:0,end:0}},set:function(t,e){if("object"!=typeof e&&(e={begin:e,end:e}),t.setSelectionRange)t.focus(),t.setSelectionRange(e.begin,e.end);else if(t.createTextRange){var s=t.createTextRange();s.collapse(!0),s.moveEnd("character",e.end),s.moveStart("character",e.begin),s.select()}}}),repeat:!1,placeholder:" "},c={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/},v.addInptType=function(t,e){c[t]=e},v.prototype.resetPattern=function(t){this.opts.patterns=t?this._specFromSinglePattern(t):this.opts.patterns,this.sel=h.get(this.el),this.val=this.el.value,this.delta=0,this._removeChars(),this.patternMatcher=a(this.opts.patterns);var e=this.patternMatcher.getPattern(this.val);this.mLength=e.mLength,this.chars=e.chars,this.inpts=e.inpts,this._processKey("",!1,!0)},v.prototype._updatePattern=function(){var t=this.patternMatcher.getPattern(this.val);t&&(this.mLength=t.mLength,this.chars=t.chars,this.inpts=t.inpts)},v.prototype._keyDown=function(t){var e=t.which||t.keyCode;if(e&&o.isDelKeyDown(t.which,t.keyCode))return this._processKey(null,e),o.preventDefault(t)},v.prototype._keyPress=function(t){var e,s;if(e=t.which||t.keyCode,s=o.isSpecialKeyPress(t.which,t.keyCode),!o.isDelKeyPress(t.which,t.keyCode)&&!s&&!o.isModifier(t))return this._processKey(String.fromCharCode(e),!1),o.preventDefault(t)},v.prototype._paste=function(t){return this._processKey(o.getClip(t),!1),o.preventDefault(t)},v.prototype._focus=function(){var t=this;setTimeout(function(){var e=h.get(t.el),s=e.end>t.focus,n=0===e.end;(s||n)&&h.set(t.el,t.focus)},0)},v.prototype._processKey=function(t,e,s){if(this.sel=h.get(this.el),this.val=this.el.value,this.delta=0,this.sel.begin!==this.sel.end)this.delta=-1*Math.abs(this.sel.begin-this.sel.end),this.val=o.removeChars(this.val,this.sel.begin,this.sel.end);else if(e&&46===e)this._delete();else if(e&&0<=this.sel.begin-1)this.val=o.removeChars(this.val,this.sel.end-1,this.sel.end),--this.delta;else if(e)return!0;e||(this.val=o.addChars(this.val,t,this.sel.begin),this.delta+=t.length),this._formatValue(s)},v.prototype._delete=function(){for(;this.chars[this.sel.begin];)this._nextPos();this.sel.begin<this.val.length&&(this._nextPos(),this.val=o.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1)},v.prototype._nextPos=function(){this.sel.end++,this.sel.begin++},v.prototype._formatValue=function(t){this.newPos=this.sel.end+this.delta,this._removeChars(),this._updatePattern(),this._validateInpts(),this._addChars(),this.el.value=this.val.substr(0,this.mLength),void 0!==t&&!1!==t||h.set(this.el,this.newPos)},v.prototype._removeChars=function(){this.sel.end>this.focus&&(this.delta+=this.sel.end-this.focus);for(var t=0,e=0;e<=this.mLength;e++){var s,n=this.chars[e],i=this.hldrs[e],r=e+t;r=e>=this.sel.begin?r+this.delta:r,s=this.val.charAt(r),(n&&n===s||i&&i===s)&&(this.val=o.removeChars(this.val,r,r+1),t--)}this.hldrs={},this.focus=this.val.length},v.prototype._validateInpts=function(){for(var t=0;t<this.val.length;t++){var e=this.inpts[t],s=!c[e],n=!s&&!c[e].test(this.val.charAt(t)),i=this.inpts[t];(s||n)&&i&&(this.val=o.removeChars(this.val,t,t+1),this.focusStart--,this.newPos--,this.delta--,t--)}},v.prototype._addChars=function(){if(this.opts.persistent){for(var t=0;t<=this.mLength;t++)this.val.charAt(t)||(this.val=o.addChars(this.val,this.opts.placeholder,t),this.hldrs[t]=this.opts.placeholder),this._addChar(t);for(;this.chars[this.focus];)this.focus++}else for(var e=0;e<=this.val.length;e++){if(this.delta<=0&&e===this.focus)return!0;this._addChar(e)}},v.prototype._addChar=function(t){var e=this.chars[t];if(!e)return!0;o.isBetween(t,[this.sel.begin-1,this.newPos+1])&&(this.newPos++,this.delta++),t<=this.focus&&this.focus++,this.hldrs[t]&&(delete this.hldrs[t],this.hldrs[t+1]=this.opts.placeholder),this.val=o.addChars(this.val,e,t)},v.prototype._specFromSinglePattern=function(t){return[{"*":t}]},v);function v(t,e){var s=this;if(s.el=t,!s.el)throw new TypeError("Must provide an existing element");if(s.opts=o.extend({},l,e),void 0!==s.opts.pattern&&(s.opts.patterns=s._specFromSinglePattern(s.opts.pattern),delete s.opts.pattern),void 0===s.opts.patterns)throw new TypeError("Must provide a pattern or array of patterns");s.patternMatcher=a(s.opts.patterns),s._updatePattern(),s.hldrs={},s.focus=0,o.addListener(s.el,"keydown",function(t){s._keyDown(t)}),o.addListener(s.el,"keypress",function(t){s._keyPress(t)}),o.addListener(s.el,"paste",function(t){s._paste(t)}),s.opts.persistent&&(s._processKey("",!1),s.el.blur(),o.addListener(s.el,"focus",function(t){s._focus(t)}),o.addListener(s.el,"click",function(t){s._focus(t)}),o.addListener(s.el,"touchstart",function(t){s._focus(t)}))}var g="formatter";$.fn[g]=function(t){return"object"==typeof t&&this.each(function(){$.data(this,"plugin_"+g)||$.data(this,"plugin_"+g,new f(this,t))}),this.resetPattern=function(t){return this.each(function(){var e=$.data(this,"plugin_"+g);e&&e.resetPattern(t)}),this},this},$.fn[g].addInptType=function(t,e){f.addInptType(t,e)}});